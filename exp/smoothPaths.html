<!DOCTYPE html>
<html>

<head>
  <title>Data Comets</title>

  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <meta charset="utf-8" />

  <!-- leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==" crossorigin=""></script>



  <!-- Jquery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <!-- Materialize-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">


  <!-- D3 -->
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="https://d3js.org/d3-path.v1.min.js"></script>
  <script src="https://d3js.org/d3-color.v1.min.js"></script>
  <script src="https://d3js.org/d3-interpolate.v1.min.js"></script>
  <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
  <script src="https://d3js.org/d3-selection-multi.v0.4.min.js"></script>

 
</head>

<body>



  
 
  <div id="map-canvas" style="position: relative; z-index: 1; height: 1000px;">
    
  </div>


</body>

<script>
var map = L.map("map-canvas", {
    center: [32.3874292, -117.0763872],
    zoom: 20,
    maxZoom: 25,
    minZoom: 1
  });
  
var Esri_WorldTopoMap = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
  maxZoom: 20,
  maxNativeZoom: 18
});

Esri_WorldTopoMap.addTo(map);
  
L.svg().addTo(map);
/* 
d3.select("#map-canvas")
  .select("svg")
  .selectAll("myCircles")
  .data([0])
  .enter()
  .append("circle")
    .attr("cx", function(d){ return map.latLngToLayerPoint([32.3874292, -117.0763872]).x })
    .attr("cy", function(d){ return map.latLngToLayerPoint([32.3874292, -117.0763872]).y })
    .attr("r", 14)
    .style("fill", "red")
    .attr("stroke", "red")
    .attr("stroke-width", 3)
    .attr("fill-opacity", .4)
  
  // Function that update circle position if something change
function update() {
  d3.selectAll("circle")
    .attr("cx", function(d){ return map.latLngToLayerPoint([32.3874292, -117.0763872]).x })
    .attr("cy", function(d){ return map.latLngToLayerPoint([32.3874292, -117.0763872]).y })
}

// If the user change the map (zoom or drag), I update circle position:
map.on("moveend", update)
*/
d3.csv("../data/milestone3_modified.csv", function(data){
 
  line1 = data.slice(100,120);
  
  var smoothLine = d3.line()
        .x(function (d) {
           var lat = d.lat/10000000; var lon = d.lon/10000000; return map.latLngToLayerPoint([lat,lon]).x 
        })
        .y(function (d) {
          var lat = d.lat/10000000; var lon = d.lon/10000000; return map.latLngToLayerPoint([lat,lon]).y 
        })
       
  
  
  
  start = 0;
  for(i = 0; i < data.length/4; i++){
    line = data.slice(start,start+4);
    if (start != 0 && start <= data.length){
      line.unshift(data[start - 1])
    }
    start = start + 4
    console.log(line)
     d3.select("#map-canvas")
          .select("svg")
          .selectAll("smoothPath")
          .data([line])
          .enter()
          .append('path')
          .attr('class', 'fullPath')
          .attr('stroke', 'red')
          .attr('fill', 'none')
          .style('stroke-width', 5)
          .style('opacity', 1)
          .attr('d', smoothLine);
  }
  
  
   
  
  /*
  var start = data[0];
  
  console.log(start)
  
  d3.select("#map-canvas")
  .select("svg")
  .selectAll("myCircles")
  .data([start])
  .enter()
  .append("circle")
    .attr("cx", function(d){ var lat = d.lat/10000000; var lon = d.lon/10000000; return map.latLngToLayerPoint([lat,lon]).x })
    .attr("cy", function(d){ var lat = d.lat/10000000; var lon = d.lon/10000000; return map.latLngToLayerPoint([lat,lon]).y })
    .attr("r", 5)
    .style("fill", "red")
    .attr("stroke", "red")
    .attr("stroke-width", 3)
    .attr("fill-opacity", .4)
  */
  
  function update() {
    d3.selectAll("path")
      .style('stroke-width', 5)
      .attr('d', smoothLine);
    }
  
  
  
  
  map.on("moveend", update)

  
})  


</script>
</html>